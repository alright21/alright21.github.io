<!doctype html><html lang=en-us><head><link rel=stylesheet href=/styles.css><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Intercepting Non-HTTP Traffic in Android | Alberto Giust</title>
<link rel=canonical href=https://alright21.github.io/security/mobile_nohttp/><meta name=description content="Hi, I am Alberto Giust, aka `alright(21)?`, penetration tester at Spike Reply and security enthusiast. In this website you will find CTF writeups and other interesting things I want to document about my journey through the magical world of Cybersecurity."><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="Intercepting Non-HTTP Traffic in Android"><meta property="og:description" content="Recently I have started solving a mobile security CTF called hpAndro and I stumbled upon two challenges focusing on intercepting non-HTTP traffic in Android. I tried to check if I could do it by setting up Wireshark on my laptop and detect this communication directly from that, but it was not working.
I thought I could change my perspective and monitor traffic directly from my device (it is always Linux). In this short article, I will show two methodologies I found to monitor app traffic, especially non-HTTP one."><meta property="og:type" content="article"><meta property="og:url" content="https://alright21.github.io/security/mobile_nohttp/"><meta property="article:section" content="security"><meta property="article:published_time" content="2023-09-06T12:25:03+02:00"><meta property="article:modified_time" content="2023-09-06T12:25:03+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Intercepting Non-HTTP Traffic in Android"><meta name=twitter:description content="Recently I have started solving a mobile security CTF called hpAndro and I stumbled upon two challenges focusing on intercepting non-HTTP traffic in Android. I tried to check if I could do it by setting up Wireshark on my laptop and detect this communication directly from that, but it was not working.
I thought I could change my perspective and monitor traffic directly from my device (it is always Linux). In this short article, I will show two methodologies I found to monitor app traffic, especially non-HTTP one."><link rel=stylesheet href=https://alright21.github.io/css/styles.e282735e308195f4ba7bde9c23d7b770c438e682fdb8dd70ed9a1cc443b0ba4ce94a817547eb664fefe53bc615142aa923a0f8f94bb58b5f2441d213e6d7d0a9.css integrity="sha512-4oJzXjCBlfS6e96cI9e3cMQ45oL9uN1w7ZocxEOwukzpSoF1R+tmT+/lO8YVFCqpI6D4+Uu1i18kQdIT5tfQqQ=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://alright21.github.io/favicon.ico><div id=cookie-notice><span>We would like to use third party cookies and scripts to improve the
functionality of this website.</span>
<a id=cookie-notice-accept class="btn btn-primary btn-sm">Approve</a>
<a id=cookie-notice-deny class="btn btn-primary btn-sm">Deny</a>
<a href=/privacy id=cookie-notice-privacy class="btn btn-primary btn-sm">More info</a><br><span id=cookie-credits>Credits to this banner: <a id=cookie-notice-privacy href=https://github.com/Kudos01>Kudos01</a></div></div><script>function createCookie(e,t,n){var s,o="";n&&(s=new Date,s.setTime(s.getTime()+n*24*60*60*1e3),o="; expires="+s.toUTCString()),document.cookie=e+"="+t+o+"; path=/"}function readCookie(e){for(var t,s=e+"=",o=document.cookie.split(";"),n=0;n<o.length;n++){for(t=o[n];t.charAt(0)==" ";)t=t.substring(1,t.length);if(t.indexOf(s)==0)return t.substring(s.length,t.length)}return null}function eraseCookie(e){createCookie(e,"",-1)}if(readCookie("cookie-notice-option")=="true"){function loadScriptAsync(e,t){if(typeof t!="function")throw new Error("Not a valid callback for async script load");var n=document.createElement("script");n.onload=t,n.src=e,document.head.appendChild(n)}loadScriptAsync("https://www.googletagmanager.com/gtag/js?id=G-7KVTDGPL67",function(){window.dataLayer=window.dataLayer||[];function e(){dataLayer.push(arguments)}e("js",new Date),e("config","G-7KVTDGPL67",{anonymize_ip:!0})})}else readCookie("cookie-notice-option")!="false"&&(document.getElementById("cookie-notice").style.display="block");document.getElementById("cookie-notice-accept").addEventListener("click",function(){createCookie("cookie-notice-option","true",31),document.getElementById("cookie-notice").style.display="none",location.reload()}),document.getElementById("cookie-notice-deny").addEventListener("click",function(){createCookie("cookie-notice-option","false",31),document.getElementById("cookie-notice").style.display="none",location.reload()})</script></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><header id=header><a href=https://alright21.github.io/><div id=logo style=background-image:url(https://alright21.github.io/images/logo.png)></div><div id=title><h1>Alberto Giust</h1></div></a><div id=nav><ul><li class=icon><a href=# aria-label=Menu><i class="fas fa-bars fa-2x" aria-hidden=true></i></a></li><li><a href=/>Home</a></li><li><a href=/security>Security</a></li><li><a href=/ctf>CTFs</a></li><li><a href=/education>Education</a></li><li><a href=/dev>Dev</a></li><li><a href=/about>About</a></li></ul></div></header><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">Intercepting Non-HTTP Traffic in Android</h1><div class=meta><div class=postdate><time datetime="2023-09-06 12:25:03 +0200 +0200" itemprop=datePublished>2023-09-06</time></div><div class=article-read-time><i class="far fa-clock"></i>
2 minute read</div></div></header><div class=content itemprop=articleBody><p>Recently I have started solving a mobile security CTF called <a href=https://ctf.hpandro.raviramesh.info/>hpAndro</a> and I stumbled upon two challenges focusing on intercepting non-HTTP traffic in Android. I tried to check if I could do it by setting up Wireshark on my laptop and detect this communication directly from that, but it was not working.</p><p>I thought I could change my perspective and monitor traffic directly from my device (it is always Linux). In this short article, I will show two methodologies I found to monitor app traffic, especially non-HTTP one.</p><h2 id=tcpdump>tcpdump</h2><p>The first method uses tcpdump to monitor traffic directly from the device&rsquo;s command line. The steps to do so are quite simple. We can directly go to <a href=https://www.androidtcpdump.com/>https://www.androidtcpdump.com/</a> and follow the instruction. IMPORTANT: we need to have a rooted device becase we have to run <code>tcpdump</code> as root!</p><p>After downloading the right binary (32bit or 64bit), we can push it into the device, and make it executable. Note that in this case I am not pushing it to a privileged folder because I am using a production build (physical device rooted), so I am not able to run <code>adb root</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>adb push tcpdump /data/local/tmp
</span></span><span style=display:flex><span>adb shell
</span></span><span style=display:flex><span>su
</span></span><span style=display:flex><span>cd /data/local/tmp
</span></span><span style=display:flex><span>chmod +x tcpdump
</span></span></code></pre></div><p>Aand it&rsquo;s done! Now we are able to run <code>tcpdump</code> from our shell (as root) and start intercepting traffic. We need to listen to an interface (<code>ip addr</code> to find out which interfaces are enbled on our Android device), and select which traffic to intercept. In this case, I had to dump TCP traffic on port 65000:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>tcpdump -i wlan0 -A <span style=color:#e6db74>&#39;tcp port 65000&#39;</span>
</span></span></code></pre></div><h2 id=pcapdroid>PCAPdroid</h2><p>The first method requires us to have a rooted device, which is not always easy. Luckily we have another solution, which is also fast to set up and does not require root privileges: entering PCAPdroid. This mobile application can be downloaded from the <a href="https://play.google.com/store/apps/details?id=com.emanuelef.remote_capture&amp;hl=en&amp;gl=US">Google Play store</a>. It is actually a game changer because it allows us to see all the traffic coming from and to our mobile device. It creates a local VPN to redirect everything, so it is not necessary to mess up with routing tables (which requires high privileges). We just need to start capturing and in the &ldquo;Connections&rdquo; tab we will see all the connections created.</p><figure><img src=/assets/pcapdroid_overview.png alt="PCAPdroid overview" style=width:60%><figcaption>PCAPdroid overview</figcaption></figure><figure><img src=/assets/pcapdroid_tcp.png alt="PCAPdroid TCP" style=width:60%><figcaption>PCAPdroid intercept TCP traffic</figcaption></figure><p>The project is also open source: <a href=https://github.com/emanuele-f/PCAPdroid>https://github.com/emanuele-f/PCAPdroid</a>! All credits goes to <a href=https://github.com/emanuele-f>emanuele-f</a>.</p><p>And that&rsquo;s all for this brief post, see you next time!</p></div></article><footer id=footer><div class=footer-left>Copyright &copy; 2024 Alberto Giust</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/security>Security</a></li><li><a href=/ctf>CTFs</a></li><li><a href=/education>Education</a></li><li><a href=/dev>Dev</a></li><li><a href=/about>About</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/js/main.js></script></html>