<!doctype html><html lang=en-us><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Mobile Security Introduction | Alberto Giust</title><link rel=canonical href=https://alright21.github.io/blog/mobile_security/><meta name=description content="Hi, I am Alberto Giust, aka `alright(21)?`, penetration tester at Spike Reply and security enthusiast. In this website you will find CTF writeups and other interesting things I want to document about my journey through the magical world of Cybersecurity."><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="Mobile Security Introduction"><meta property="og:description" content="Mobile Security Introduction This is quite a while I wanted to upload this article, and now I found the courage to do so. If you find some inconsistencies, I am always open to feedback. I will try to update it, keeping it as a &ldquo;mobile security introduction garden&rdquo;. Have fun:)
Setup Every mobile assessment requires some different setup compared to web applications. In this guide, we will explain how to enter the beatiful world of mobile security, and not feel overwhelmed by do so."><meta property="og:type" content="article"><meta property="og:url" content="https://alright21.github.io/blog/mobile_security/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2023-07-23T18:00:00+02:00"><meta property="article:modified_time" content="2023-07-23T18:00:00+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Mobile Security Introduction"><meta name=twitter:description content="Mobile Security Introduction This is quite a while I wanted to upload this article, and now I found the courage to do so. If you find some inconsistencies, I am always open to feedback. I will try to update it, keeping it as a &ldquo;mobile security introduction garden&rdquo;. Have fun:)
Setup Every mobile assessment requires some different setup compared to web applications. In this guide, we will explain how to enter the beatiful world of mobile security, and not feel overwhelmed by do so."><link rel=stylesheet href=https://alright21.github.io/css/styles.7261c083e3c1051b057257d15fa5d4e4d49345e4f16d843e2d1b7ee7dc2d24b50aba75164a857bca20bf4b3cddcc035343856b1569eedb55f90777798909d6f7.css integrity="sha512-cmHAg+PBBRsFclfRX6XU5NSTReTxbYQ+LRt+59wtJLUKunUWSoV7yiC/SzzdzANTQ4VrFWnu21X5B3d5iQnW9w=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://alright21.github.io/images/favicon.ico></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><header id=header><a href=https://alright21.github.io><div id=logo style=background-image:url(https://alright21.github.io/images/logo.png)></div><div id=title><h1>Alberto Giust</h1></div></a><div id=nav><ul><li class=icon><a href=# aria-label=Menu><i class="fas fa-bars fa-2x" aria-hidden=true></i></a></li><li><a href=/>Home</a></li><li><a href=/blog>Blog</a></li><li><a href=/about>About</a></li></ul></div></header><article class=post itemscope itemtype=http://schema.org/BlogPosting><div class=content itemprop=articleBody><h1 id=mobile-security-introduction>Mobile Security Introduction</h1><p>This is quite a while I wanted to upload this article, and now I found the courage to do so. If you find some inconsistencies, I am always open to feedback. I will try to update it, keeping it as a &ldquo;mobile security introduction garden&rdquo;. Have fun:)</p><h2 id=setup>Setup</h2><p>Every mobile assessment requires some different setup compared to web applications. In this guide, we will explain how to enter the beatiful world of mobile security, and not feel overwhelmed by do so.</p><h2 id=standard-setup>Standard setup</h2><p>We need to set up our environment to proxy the requests coming from the mobile phone. Unfortunately, almost every application implements ssl pinning techniques to prevent this: the application uses some methods to check the server certificate against a whitelist, and allows communication only if the other end is trusted. We must bypass this check to be able to intercept the request using our beloved Burp Suite.</p><h3 id=installing-burp-certificates>Installing Burp certificates</h3><p>Firstly, we need to install burp certificates on our devices. We can download them from the Burp Suite -> Proxy -> Proxy settings tab and copy them inside the device, but there is a (for me) faster way to do it (that works both in Android and iOS):</p><ul><li><strong>Android</strong>: <code>Settings -> Wifi -> select our network (the one where also the PC is connected to) -> Settings gear -> Edit Connection (the last two steps may slightly differ on your configuration, Google is your friend) -> choose Manual Proxy -> PC IP address and Burp suite listening port (I usually set up a different port, like 8086, so I can easily filter my requests) -> Save</code>. Now we can connect to http://burp and download the certificate. We must rename its extension from .der to .cer, or we won&rsquo;t be able to install it. We can now install it: <code>Settings -> Security -> Credentials -> Install a certificate</code></li><li><strong>iOS</strong>: <code>Settings -> Wifi -> Info button on our network -> HTTP Proxy -> Manual -> PC IP address and Burp suite listening port -> Save</code>. Download the certificate and the system will suggest going to Settings again to install it (check Setting notifications, it should be there).</li></ul><p>Now, we should be able to intercept HTTPS traffic if the applications do not implement SSL Pinning techniques. If the applications implement those checks, we can use some standard Frida scripts: these scripts are usually found online, for most of the standard techniques. If the developers implement some custom checks, we need to reverse the code and find which methods are used. Writing Frida scripts is beyond the scope of this guide (check the mobile guide for some details).</p><h3 id=installing-applications>Installing applications</h3><p>Applications are usually shared as compressed packages that we can install using <code>adb</code> (Android) or <code>ideviceinstaller</code> (iOS). Sometimes, we need to install them from the official store (remember to disable HTTP Proxy), or test stores (Testflight application for iOS).</p><ul><li><strong>Android</strong>: <code>adb install &lt;app.apk></code></li><li><strong>iOS</strong>: <code>ideviceinstaller -i &lt;app.ipa></code></li></ul><h3 id=frida-setup>Frida setup</h3><p>We usually need to use Frida for different purposes: bypass SSL pinning and root checks, and hook encryption functions, to name a few. iOS devices needs a different setup that we will try to explain in future updates of this article.</p><p>For Android devices, we need to set up our server manually: it is not difficult, and it is a gentle introduction to <code>adb</code>. The necessary steps are:</p><ol><li>download the latest Frida release from <a href=https://github.com/frida/frida/releases>https://github.com/frida/frida/releases</a>. The latest version should be fine, but some phones do complain about it. Try older versions, if necessary</li><li>extract the executable with <code>unxz frida-server.xz</code></li><li>copy the executable inside the device (Android smartphone must have USB debugging active and adb running): <code>adb push frida-server/data/local/tmp</code></li><li>if the device allows it, try to restart <code>adb</code> in root mode (<code>adb root</code>). If it is not possible, connect to the shell (<code>adb shell</code>) and elevate the privileges with <code>su</code></li><li>set correct file permissions: <code>chmod 755 /data/local/tmp/frida-server</code></li><li>start the server: <code>/data/local/tmp/frida-server &</code></li><li>now the server is running, you can go back to your host device and start hacking with frida scripts:)</li></ol><p>We are ready to use frida on our devices! Remember that, if the device is turned off, we need to start the server again (steps 4. and 6.).</p><p>We can start our frida journey by analyzing some useful commands that we need to spawn (launch the application) or attach (the application is already running) to a mobile application:</p><ul><li><code>frida-ps -Uai</code>: list installed application names and packages</li><li><code>frida -U -F -l &lt;script.js></code>: attach to the foreground application</li><li><code>frida -U -f &lt;package_name> -l &lt;script.js></code>: spawn desired application by package name</li><li><code>frida -U &lt;app name>(or &lt;PID>) -l &lt;script.js></code>: attach to application name</li></ul><h3 id=objection-setup>Objection setup</h3><p>Another interesting tool is <code>objection</code>, a frida wrapper written in python that automates some boring tasks. It is not perfect and it is not being updated regularly, but it is sometimes useful for some basic tests. You can install it using <code>pip</code>. Here is a list of useful commands:</p><ul><li><code>objection -g &lt;package name> explore</code>: spawn desired application by package name</li><li><code>objection -g &lt;pid> explore</code>: attach to the desired application by pid</li><li><code>objection -g &lt;app name> explore</code>: attach to the desired application by app name</li></ul><p>Another interesting feature that objection offers is the ability to watch a Java Class or a Java Class Method, by knowing the full package. We can retrieve the full package path by navigating the decompiled source in jadx (see Static Analysis section). After retrieving the package, we can monitor a specific class when a new instance is created, or when a method is called, what arguments are passed and what is the return value. After spawning the process (or attaching to it), an interactive console allows us to input these commands (objection offers an autocomplete feature that helps us explore all the commands).</p><ul><li><code>android hooking watch class &lt;package path>.&lt;class name></code>: watch the full class and its methods.</li><li><code>android hooking watch class_method &lt;package path>.&lt;class name>.&lt;method> --dump-args --dump-return --dump-backtrace</code>: watch a specific method, logging when it is called<ul><li><code>--dump-args</code>: print the argument passed to a specific method</li><li><code>--dump-return</code>: print the return value (based on the toString method implementation)</li><li><code>--dump-backtrace</code>: print the complete stack trace that caused the specific method to be called</li></ul></li></ul><p>If we have to hook a specific class or class_method right after the application is spawned, we can use <code>-s</code> flag after <code>explore</code> and issue the objection command we want to execute.</p><h2 id=static-analysis>Static Analysis</h2><p>Frida and Objection helps us instrumenting the applications and dinamically modify their flow, tamper with the arguments and return values, and watch the execution. Unfortunately, we cannot do much without knowing a bit about how the application is built, what are the activities, services, and libraries used. In mobile application assessment, the analysis of web requests is a small part of the job: we need to improve our reversing and static analysis skill to be able to understand how the client side works, if the application stores sensistive data inside the code, use unsafe methods, etc.</p><p>This section is mainly focused on Android because it is easier to obtained readable decompiled code with Java or Kotlin, rather than iOS application. For iOS application, the best solution is to use Ghidra (or IDA, if you have access to a paid licence). We just need to unzip our .ipa package, find the binary file (which is called as the app), and import it. We can use this method to search for interesting strings inside.</p><p>For Android application, we can use <a href=https://github.com/skylot/jadx>jadx</a> to decompile the Java classes and resources. Jadx offers a command line tool, but I personally think that jadx-gui is easier to grasp as a beginner because it offers a great search tool, and some other interesting features that we will see in this guide.</p><p>On Linux, we can download the zip file, go to the <code>bin</code> directory, and run <code>jadx-gui</code>. We can then open an .apk file: the program will start to decompile it, and the result will be shown as a file tree in the left side of the window. Here, we can start navigating the different activities and classes, find the package paths, understand what external libraries are used, etc.</p><p>We can now open a file containing Java code and use some powerful keybindings. Go to a method declaration and click:</p><ul><li><code>x</code>: go to usage. Search where the method is used.</li><li><code>f</code>: copy as Frida snippet. Copy a Frida hook that can be used to start scripting the easily. It automatically finds the full class name, overloads the method, prints the arguments and return value.</li></ul></div></article><footer id=footer><div class=footer-left>Copyright &copy; 2023 Alberto Giust</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/blog>Blog</a></li><li><a href=/about>About</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script></html>